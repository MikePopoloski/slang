language: cpp
sudo: false
dist: trusty

matrix:
  include:
    - env: BUILD_TARGET=linux-gcc
    #- env: BUILD_TARGET=linux-clang

addons:
  apt:
    sources:
      - ubuntu-toolchain-r-test
      - llvm-toolchain-precise
    packages:
      - gcc-7
      - g++-7
      - clang-5.0

install:
  - scripts/travis_install.sh

script:
  - if [ "$BUILD_TARGET" == "linux-clang" ]; then make -C build/projects/gmake-linux-clang -j 4; build/linux64_clang/bin/unittestsDebug; fi
  - if [ "$BUILD_TARGET" == "linux-gcc" ]; then make -C build/projects/gmake-linux -j 4; build/linux64_gcc/bin/unittestsDebug; fi
  - scripts/cppcheck.sh

branches:
  only:
    - /.*/

git:
  depth: 3

after_success:
  - bash <(curl -s https://codecov.io/bash) || echo 'Codecov failed to upload'